---
title: "Debate_01"
author: "Marcos Zamora Amengual"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

setwd("D:/Docs/Masteres/Master en Bioinformática y Bioestadística/Tercer Semestre/M0.157 - Análisis de datos ómicos/Moudlo02/Debate")

library(Biobase)
library(GEOquery)
```

-----------


### Índice

1. [BIO](#Bio)
    1. [Título](#Titulo)
    2. [Tipo de microarrays](#Tipo)
    3. [Número de muestras](#Numero)
    4. [Pregunta principal](#Pregunta)
    5. [Enlace](#Enlace)
    6. [Comentarios](#Coment)
2. [INFO](#Info)
    1. [Expression Set](#Expression)
    2. [GEOquery](#Geo)
3. [DISEÑO DE EXPERIMENTOS](#Diseño)


-----------

# Parte 1 - BIO<a name="Bio"></a>

### Título del estudio:<a name="Titulo"></a>

A genome-wide survey of interaction between rice and Magnaporthe oryzae via microarray analysis 

### Tipo de microarrays:<a name="Tipo"></a>

Para el estudio utilizaron chips para mRNA de 4x44K Oligo Rice Microarray con 42,489 sondas para oligonucleótidos 60-meros.
Se utilizaron 24 microarrays de un solo colorante con 3 réplicas independientes para cada uno de los grupos del experimento

### Número de muestras y grupos:<a name="Numero"></a>

<p style="text-align: justify">El estudio se realizó con 16 muestras de hojas obtenidas de plantas de arroz crecidas en el laboratorio a partir de semillas de Oryza sativa Nipponbare de la cepa 007.
Estas muestras se dividieron en 3 grupos dependiendo de el momento de infección de la planta con Magnaporthe oryzae; a las 24, 48 y 72 horas tras la inoculación del hongo en la planta</p>

### Pregunta principal:<a name="Pregunta"></a>

Estudiar si hay respuesta en la expresión génica frente a la infección por Magnaporthe oryzae y en caso de que la haya que genes son los que modifican su expresión

### Enlace:<a name="Enlace"></a>

https://doi.org/10.1080/21655979.2020.1860479

### Comentarios:<a name="Coment"></a>

<p style="text-align: justify">Lo que me parece interesante de este estudio aparte de su relevancia social, ya que el arroz es una fuente de alimento vital para muchas comunidades humanas, es el hecho de que los 3 grupos del estudio son muy claros y que los resultados obtenidos muestran muy bien las diferencias entre ellos, lo que sirve de ejemplo, muy visual y claro, de lo que es un estudio con microarrays del tipo “class comparison”</p>

# Parte 2 - INFO<a name="Info"></a>

### Expression Set<a name="Expression"></a>

La clase **Expression Set** del paquete Biobase utiliza la programación orientada a objetos para procesar de manera más eficiente los datos obtenidos en estudios de microarrays. La clase Expression Set divide estos datos en distintas porciones de pendiendo del tipo de datos:  

* **assayData**: datos de expression de los experimentos de microarrays(datos obtenidos como resultado del experimento)

* **phenoData**: meta datos que describen las muestras usadas en el experimento  

* **featureData**: datos sobre el chip y la tecnología usada en el experimento  

* **protocolData**: datos sobre el protocolo usado para el procesado de cada muestra  

* **experimentData**: datos flexibles para describir el experimento  


Vamos a crear abajo un objeto de clase Expression Set a partir de datos que nos vamos a inventar  
Para esto vamos a generar 3 tipos de información:  

* **expressionValues**: Datos de expresión de los microarrrays  

```{r}
expressionValues <- matrix(rnorm(100), nrow = 10)
colnames(expressionValues) <- paste0("sample",1:10)
# generamos la información aleatoria sobre los resultados de nuestro experimento de microarrays

head(expressionValues)
```

* **Covariates**: Datos sobre las muestras usadas en el experimento como la edad de los pacientes o el tratamiento que reciben  

```{r}
Covariates <- data.frame(sampleNames = paste0("sample",1:10),
                      group=c(paste0("Treatment",1:5),paste0("Control",1:5)),
                      age = rpois(10, 50), 
                      sex=as.factor(sample(c("Male", "Female"),10,replace=TRUE)),
                      row.names=1)
# generamos la información sobre nuestras muestras

head(Covariates, n=10)
```

* **ExpInfo**: Información sobre el experimento que se ha realizado  

```{r}
ExpInfo=list(name="Marcos Zamora", lab="UOC WorkFromHome",
          contact="myemail@somegoogle3rdparty.domain", abstract="Generating ExpressionSet objects")
# generamos la información sobre nuestro experimento

show(ExpInfo)
```

Una vez hemos generado toda nuestra información podemos crear un objeto de clase ExpressionSet a partir de ella. Primero vamos a añadir los resultados del estudio de microarrays

```{r}
myExpSet <- ExpressionSet(expressionValues)
```

En segundo lugar vamos a añadir la información de las muestras que hemos guardado en Covariates

```{r}
columnDesc <-  data.frame(labelDescription= c("Treatment/Control", 
                                                "Age at disease onset", 
                                                "Sex of patient (Male/Female"))
myAnnotDF <- new("AnnotatedDataFrame", data=Covariates, varMetadata= columnDesc)
# en primer lugar generamos un annotated data frame con explicaciones más claras de cada una de las columnas y con
# los datos de Covariates

myExpSet <- ExpressionSet(assayData = expressionValues, phenoData = myAnnotDF)
```

Podemos tambien añadir la información sobre los genes estudiados en forma de vector con una longitud igual a las filas de nuestra assayData y la información adicional sobre nuestro experimento

```{r}
myGenes <- paste0("Gene",10:20)

myDesc <- new("MIAME", name= ExpInfo[["name"]],
            lab= ExpInfo[["lab"]],
            contact= ExpInfo[["contact"]] ,
            abstract= ExpInfo[["abstract"]])

myExpSet <- ExpressionSet(assayData=expressionValues,
                        phenoData=myAnnotDF,
                        fetureNames =myGenes,
                        experimentData = myDesc)

show(myExpSet)
```

Manipulando un objeto de clase ExpresionSet mediante los comandos **exprs()** con el que se accede a la parte de assayData del Expression Set y el comando **pData** con el que se accede a la parte de phenoData

```{r}
all(colnames(exprs(myExpSet))==rownames(pData(myExpSet)))

dim(exprs(myExpSet))

head(pData(myExpSet), 10)
```

Tambien podemos generar subsets más pequeños a partir de nuestro objeto Expression Set y gracias a los beneficios de la clase Expression Set podemos dividir a la vez la phenoData y la assayData

```{r}
youngExpSet <- myExpSet[,pData(myExpSet)$age<50]

head(pData(youngExpSet))
```

### GEOquery<a name="Geo"></a>

Podemos introducir los datos desde GEO y almacenarlos en un objeto de clase Expression Set de manera sencilla y sin tener que crear el objeto desde 0
Por problemas con el programa R ya que no conseguía cargar los archivos de GEOquery probablemento por su elevado tamaño no he continuado esta parte

```{r}
# gse <- getGEO("GSE58435")
# gse[[1]]
# expSetGEO <- gse[[1]]

# expSetGEO <- getGEO(filename = "GSE58435.txt", GSEMatrix = TRUE)
```

# Parte 3 - Diseño de Experimentos<a name="Diseño"></a>

El experimento en el que trato en la parte 1 de este informe se trata de un estudio que compara la expresión génica de unas hojas en 3 momentos distintos durante la infección por parte de un patógeno. Por ello el estudio lo que realiza es una comparación de grupos (*class comparison*) entre los distintos estadios de infección.

En cuanto a los pasos a seguir para la buena praxis en el Diseño de Experimentos; los puntos más importantes y cruciales son la Replicación de nuestros datos para tener un experimento que sea estadisticamente representativo y fiable y la Aleatorización de los grupos para minimizar el efecto de variables independientes en nuestros resultados.
Esto se puede afinar utilizando métodos estadísticos como por ejemplo calculando el Poder de nuestro experimento para poder calcular el número de muestras a la hora de hacer el experimento.

El Poder de nuestro experimento se puede calcular utilizando paquetes de R como el paquete **pwr** con el cual se puede calcular el poder de un experimento introduciendo el tamaño del efecto, de la muestra y la significancia
